<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Register â€¢ Time Nest</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap"
    rel="stylesheet"
  />
  <link rel="stylesheet" href="./css/style.css" />
</head>

<body class="auth-page">
  <header>
    <h1>Time Nest</h1>
    <nav>
      <a href="./index.html">Home</a>
      <a href="./login.html">Login</a>
      <button id="theme-toggle" title="Toggle theme">ðŸŒ™</button>
    </nav>
  </header>
  <main>
    <section class="card auth-card">
      <h2>Create your Time Nest</h2>
      <p class="muted mb-1">Set up your account and define your focus goals.</p>

      <form id="register-form" class="auth-form" novalidate>
        <div class="form-group">
          <label for="full-name">Full Name</label>
          <input type="text" id="full-name" placeholder="Alex Johnson" required />
          <p class="helper-text">This will be shown on your profile.</p>
        </div>

        <div class="form-group">
          <label for="username">Username</label>
          <input type="text" id="username" placeholder="alex" required />
          <p class="helper-text">Used to personalize your workspace.</p>
        </div>

        <div class="form-group">
          <label for="email">Email</label>
          <input type="email" id="email" placeholder="you@example.com" required />
          <p class="helper-text">You'll use this to sign in.</p>
        </div>

        <div class="form-group">
          <label for="password">Password</label>
          <div class="password-field">
            <input type="password" id="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" required />
            <button type="button" id="toggle-register-password" class="ghost-btn">Show</button>
          </div>
          <p class="helper-text">Use at least 8 characters with a mix of letters and numbers.</p>
        </div>

        <div class="form-group">
          <label for="goal">Focus Goal (optional)</label>
          <input type="text" id="goal" placeholder="e.g. Study 2 hours daily" />
        </div>

        <button type="submit" id="register-submit">Create account</button>
      </form>

      <p id="register-status" class="muted mt-1"></p>
      <p class="muted text-center mt-1">Already have an account? <a href="./login.html">Sign in</a></p>
    </section>
  </main>
  <script src="./js/theme.js"></script>
  <script src="./js/auth.js"></script>
  <script>
    const registerForm = document.getElementById('register-form');
    const registerStatus = document.getElementById('register-status');
    const registerPasswordInput = document.getElementById('password');
    const toggleRegisterPasswordBtn = document.getElementById('toggle-register-password');

    toggleRegisterPasswordBtn.addEventListener('click', () => {
      const isPassword = registerPasswordInput.type === 'password';
      registerPasswordInput.type = isPassword ? 'text' : 'password';
      toggleRegisterPasswordBtn.textContent = isPassword ? 'Hide' : 'Show';
    });

    registerForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      registerStatus.textContent = '';

      const fullName = document.getElementById('full-name').value.trim();
      const username = document.getElementById('username').value.trim();
      const email = document.getElementById('email').value.trim().toLowerCase();
      const password = registerPasswordInput.value;
      const goal = document.getElementById('goal').value.trim();

      if (!fullName || !username || !email || !password) {
        registerStatus.textContent = 'Please fill in all required fields.';
        return;
      }

      registerStatus.textContent = 'Creating your accountâ€¦';
      document.getElementById('register-submit').disabled = true;

      try {
        const res = await window.TimeNestAuth.register(email, password);
        if (res.ok) {
          // Store basic profile preferences locally for now
          const profileKey = 'timenest_profile_' + email;
          const profile = {
            fullName,
            username,
            goal,
          };
          localStorage.setItem(profileKey, JSON.stringify(profile));

          registerStatus.textContent = 'Account created! Redirectingâ€¦';
          window.location.href = './login.html';
        } else {
          registerStatus.textContent = res.data?.error || `Registration failed (${res.status})`;
        }
      } catch (err) {
        registerStatus.textContent = 'Registration failed. Please try again.';
      } finally {
        document.getElementById('register-submit').disabled = false;
      }
    });
  </script>
  <script src="https://cdn.botpress.cloud/webchat/v3.5/inject.js"></script>
  <script src="https://files.bpcontent.cloud/2026/01/14/15/20260114155138-2XVSN1A9.js" defer></script>
</body>

</html>